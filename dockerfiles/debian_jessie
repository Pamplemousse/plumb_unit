FROM debian:jessie

MAINTAINER cc_doc_nfc.oab@orange.com <cc_doc_nfc.oab@orange.com>   

VOLUME [ "/sys/fs/cgroup" ]

ENV container docker

RUN DEBIAN_FRONTEND=noninteractive apt-get update && apt-get -y dist-upgrade

RUN (cd /lib/systemd/system/sysinit.target.wants/ ;\
     rm -f $(ls | grep -v systemd-tmpfiles-setup.service))
RUN rm -f /lib/systemd/system/multi-user.target.wants/*;\
    rm -f /etc/systemd/system/*.wants/*;\
    rm -f /lib/systemd/system/local-fs.target.wants/*; \
    rm -f /lib/systemd/system/sockets.target.wants/*udev*; \
    rm -f /lib/systemd/system/sockets.target.wants/*initctl*; \
    rm -f /lib/systemd/system/basic.target.wants/*;\
    rm -f /lib/systemd/system/anaconda.target.wants/*;\
    rm -f /usr/lib/tmpfiles.d/systemd-nologin.conf

RUN rm -f /lib/systemd/system/systemd*udev* ; \
    rm -f /lib/systemd/system/getty.target;

RUN DEBIAN_FRONTEND=noninteractive apt-get update && \
    apt-get install -y locales python-pip python-dev \
                       git sudo aptitude vim \
                       libffi-dev libssl-dev curl \
                       net-tools \
                       libyaml-dev python-yaml python-dns \
                       python-pyasn1 python-jinja2

#RUN pip install --upgrade PyYAML jinja2 paramiko ansible dnspython setuptools pyasn1
RUN pip install --upgrade paramiko ansible setuptools

# Optimize first run of apt ansible module
RUN ansible -i localhost, -c local all -m apt -a "update_cache=yes"

ADD files/locale.gen /etc/locale.gen
RUN locale-gen
ENV LANG fr_FR.UTF-8

# Add a local user to avoid running ansible as root. This user has a name
RUN useradd -ms /bin/bash -c "Robert Paulson" rpaulson
RUN echo "rpaulson ALL=(root) NOPASSWD: ALL" > /etc/sudoers.d/rpaulson

ENV TERM xterm

CMD ["/sbin/init"]
